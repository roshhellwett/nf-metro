%%metro title: Proteomics Quantification Pipeline
%%metro style: dark
%%metro line: tmt | TMT Labeling | #e63946
%%metro line: lfq | Label-Free | #457b9d
%%metro line: dia | DIA | #2a9d8f

graph LR
    subgraph sample_prep [Sample Preparation]
        sp_input[Input]
        sp_validate[Validate]
        sp_extract[Extract]
        sp_tag[Tag]
        sp_filt_a[Filter A]
        sp_filt_b[Filter B]
        sp_merge[Merge]
        sp_filter[QC Filter]
        sp_qc[Final QC]

        sp_input -->|tmt,lfq,dia| sp_validate
        sp_validate -->|tmt,lfq,dia| sp_extract
        sp_extract -->|tmt,lfq,dia| sp_tag
        sp_tag -->|tmt,lfq,dia| sp_filt_a
        sp_tag -->|tmt,lfq,dia| sp_filt_b
        sp_filt_a -->|tmt,lfq,dia| sp_merge
        sp_filt_b -->|tmt,lfq,dia| sp_merge
        sp_merge -->|tmt,lfq,dia| sp_filter
        sp_filter -->|tmt,lfq,dia| sp_qc
    end

    subgraph tmt_quant [TMT Quantification]
        tmt_label[Label]
        tmt_frac[Fractionate]
        tmt_pool[Pool]
        tmt_quant_ms[Quantify]
        tmt_check[Check]

        tmt_label -->|tmt| tmt_frac
        tmt_frac -->|tmt| tmt_pool
        tmt_pool -->|tmt| tmt_quant_ms
        tmt_quant_ms -->|tmt| tmt_check
    end

    subgraph lfq_quant [Label-Free Quantification]
        lfq_align[Align]
        lfq_quant_ms[Quantify]
        lfq_norm[Normalize]

        lfq_align -->|lfq| lfq_quant_ms
        lfq_quant_ms -->|lfq| lfq_norm
    end

    subgraph dia_quant [DIA Quantification]
        dia_window[Window]
        dia_extract[Extract]
        dia_quant_ms[Quantify]

        dia_window -->|dia| dia_extract
        dia_extract -->|dia| dia_quant_ms
    end

    subgraph normalize [Normalization]
        norm_input[Input]
        norm_calc[Calculate]
        norm_apply[Apply]

        norm_input -->|tmt,lfq,dia| norm_calc
        norm_calc -->|tmt,lfq,dia| norm_apply
    end

    subgraph stat_analysis [Statistical Analysis]
        stat_merge[Merge]
        diff_expr[Diff. Expression]
        pathway[Pathway]
        volcano[Volcano Plot]

        stat_merge -->|tmt,lfq,dia| diff_expr
        diff_expr -->|tmt,lfq,dia| pathway
        pathway -->|tmt,lfq,dia| volcano
    end

    subgraph reporting [Reporting]
        report_agg[Aggregate]
        report_mqc[MultiQC]
        report_final[Report]

        report_agg -->|tmt,lfq,dia| report_mqc
        report_mqc -->|tmt,lfq,dia| report_final
    end

    sp_qc -->|tmt| tmt_label
    sp_qc -->|lfq| lfq_align
    sp_qc -->|dia| dia_window
    tmt_check -->|tmt| norm_input
    lfq_norm -->|lfq| norm_input
    dia_quant_ms -->|dia| norm_input
    norm_apply -->|tmt,lfq,dia| stat_merge
    volcano -->|tmt,lfq,dia| report_agg
